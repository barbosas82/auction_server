<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  	 <title>Gestao Leiloes Coisas </title>

	<link rel='shortcut icon' href='./images/favicon.png' type='image/x-icon'/>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="./css/bootstrap.min2.css" />

    <link rel="stylesheet" href="./css/style-min.css"/>

    <!-- <script async src="script/require.js" data-main="./script/mainfull.js"></script> -->

    <script type="text/javascript" src="script/jquery.min.js"></script>
    <script type="text/javascript" src="script/jquery-ui.min.js"></script>
    <script type="text/javascript" src="script/bootstrap.min.js"></script>
    <!-- <script type="text/javascript" src="script/tes_api.js"></script> -->



    <script type="text/javascript">
        var keypressed = false;

        function saveToDatabase(e, editableObj,column,id) {
            //e.preventDefault();
            editableObj.contentEditable=false;

            if(e.keyCode != 13){
                keypressed = false;
            }

            if ( keypressed == false) {
                $(editableObj).css("background","url(./images/loaderIcon.gif) no-repeat right");

              //alert($(editableObj).css("background-color"););

              //alert(e + " - " + editableObj.innerHTML + " - " + column + " - " + id)

              $.ajax({
                type: 'POST',
                url: '/index.php',
                data: { 'coluna': column, 'editval': editableObj.innerHTML.replace('€', '').replace('&euro;', '').replace(' ', '').replace('&nbsp;', '').replace("<br>", ""), 'id1': id},
                dataType: 'text',
                success: function(data){
                  $(editableObj).css("background","none");
                  $('#sucesso').show().center();

                  setTimeout(function(){ window.location.reload();}, 3000);

              },
              error: function(jqXHR, textStatus, errorThrown){
                $('#erro').show().center();
              }
             });
            }
        };

	function check(cb, id)
	{
    	  if($(cb).is(":checked"))
    	 {
          //alert("IS Checked " + id);
	  	  $.ajax({
                type: 'POST',
                url: '/index.php',
                data: {'checked': 'true', 'id': id},
                dataType: 'text',
                success: function(data){
                  window.location.reload();
              },
              error: function(jqXHR, textStatus, errorThrown){
                $('#erro').show().center();
              }
             });

    	 }else
	   {
	     //alert("IS Not Checked");
  	     $.ajax({
                type: 'POST',
                url: '/index.php',
                data: {'checked': 'false', 'id': id},
                dataType: 'text',
                success: function(data){
                  window.location.reload();
              },
              error: function(jqXHR, textStatus, errorThrown){
                $('#erro').show().center();
              }
             });
	   }

 	}


        function handle(e, editableObj,column,id){
            if(e.keyCode === 13){
              saveToDatabase(e, editableObj,column,id);
              keypressed = true;
          }
        }

        function placeCaretAtEnd(el) {
            el.innerHTML = el.innerHTML.replace('€', '').replace('&euro;', '').replace(' ', '').replace('&nbsp;', '').replace("<br>", "");
            el.focus();
            if (typeof window.getSelection != "undefined"
                && typeof document.createRange != "undefined") {
                var range = document.createRange();
            range.selectNodeContents(el);
            range.collapse(false);
            var sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
        } else if (typeof document.body.createTextRange != "undefined") {
            var textRange = document.body.createTextRange();
            textRange.moveToElementText(el);
            textRange.collapse(false);
            textRange.select();
          }
        }

        function removeAuctions(type) {
            if (confirm("Are you sure you want to delete?")) {
                $.ajax({
                    type: 'POST',
                    url: '/index.php',
                    data: { 'deleteAuction': type},
                    dataType: 'text',
                    success: function(data){
                        $('#sucesso').show().center();
                        setTimeout(function(){ window.location.reload();}, 3000);

                      },
                      error: function(jqXHR, textStatus, errorThrown){
                        $('#erro').show().center();
                    }
                });
            }
        }



          $.ajax({
            type: 'GET',
            url: 'http://bid2.doismeios.pt:8080/api/auction',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            beforeSend: function (xhr) {
              xhr.setRequestHeader('x-access-token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyIkX18iOnsic3RyaWN0TW9kZSI6dHJ1ZSwiZ2V0dGVycyI6e30sIndhc1BvcHVsYXRlZCI6ZmFsc2UsImFjdGl2ZVBhdGhzIjp7InBhdGhzIjp7InNhbHQiOiJtb2RpZnkiLCJoYXNoZWRQYXNzd29yZCI6Im1vZGlmeSIsInJvbGUiOiJpbml0IiwidXNlcm5hbWUiOiJpbml0IiwiX192IjoiaW5pdCIsImVtYWlsIjoiaW5pdCIsImNyZWF0ZWRBdCI6ImluaXQiLCJ1cGRhdGVkQXQiOiJpbml0IiwiX2lkIjoiaW5pdCJ9LCJzdGF0ZXMiOnsiaWdub3JlIjp7fSwiZGVmYXVsdCI6e30sImluaXQiOnsiX192Ijp0cnVlLCJyb2xlIjp0cnVlLCJlbWFpbCI6dHJ1ZSwidXNlcm5hbWUiOnRydWUsImNyZWF0ZWRBdCI6dHJ1ZSwidXBkYXRlZEF0Ijp0cnVlLCJfaWQiOnRydWV9LCJtb2RpZnkiOnsic2FsdCI6dHJ1ZSwiaGFzaGVkUGFzc3dvcmQiOnRydWV9LCJyZXF1aXJlIjp7fX0sInN0YXRlTmFtZXMiOlsicmVxdWlyZSIsIm1vZGlmeSIsImluaXQiLCJkZWZhdWx0IiwiaWdub3JlIl19LCJlbWl0dGVyIjp7ImRvbWFpbiI6bnVsbCwiX2V2ZW50cyI6e30sIl9ldmVudHNDb3VudCI6MCwiX21heExpc3RlbmVycyI6MH19LCJpc05ldyI6ZmFsc2UsIl9kb2MiOnsiX192IjowLCJyb2xlIjoiYWRtaW4iLCJlbWFpbCI6InBlZHJvYmFyYm9zYUBwYi5jb20ucHQiLCJzYWx0IjoiZjM3NjhhNmZjOTJiMDg1MmEyMzBjNTNiN2MzNWIxMTExYWM5Njc0OGE4ODYwNzU0NWQzZGQ3ODJiNTdmM2MzMSIsImhhc2hlZFBhc3N3b3JkIjoiZTg2NzVkY2RjMWQ3Mjk2NmY2NGExYzQwNmQ0N2I1MWEyOGMwM2NkZCIsInVzZXJuYW1lIjoicGIiLCJjcmVhdGVkQXQiOiIyMDE3LTAyLTAxVDE3OjQ4OjE2LjIwNloiLCJ1cGRhdGVkQXQiOiIyMDE3LTAyLTAxVDE3OjQ4OjE2LjIwNloiLCJfaWQiOjB9LCJpYXQiOjE0ODYwMzcwMTYsImV4cCI6MTQ4NjQ2OTAxNn0.Gp11e_IyldfgOzxEPPMYT91qcewc-MADpWwVFhsVO6Y');
            },
            success: function (data, status, jqXHR) {
            //Do stuff with the JSON data
              var leiloesAgendados = document.getElementById("leiloesAgendados");
              var numLeiloes = data.message.length;

              var tr = document.createElement('tr');
              var headertitles = ["ID Leilao", "Max Bid", "Current Bid", "Data Fim", "Nome", "Vendedor", "Estado"];


              for (var i = 0; i<headertitles.length; i++){
                var th = document.createElement('th');
                th.appendChild(document.createTextNode(headertitles[i]));
                tr.appendChild(th);
              }
              leiloesAgendados.appendChild(tr);

              var idsToHeader = ["_id", "maxbid", "currentbid", "enddate", "name", "seller", "status"];
              if (numLeiloes > 0) {
                var idx = 0;
                for (idx; idx < numLeiloes; idx++){
                  var tr = document.createElement('tr');

                  for (var i = 0; i < idsToHeader.length; i++){
                    var td = document.createElement('td');
                    td.appendChild(document.createTextNode(data.message[idx].idsToHeader[i]));
                    tr.appendChild(td);
                  }
                  leiloesAgendados.appendChild(tr);
                }
              }

            },
             error: function (jqXHR, status) {
                 // error handler
             }
            });
    </script>

</head>

<body>

    <ul id=menu>
        <li class="active"><a href="./">Gestão de Leilões</a></li>
        <li><a href="./wantlist.php">Lista de istas</a></li>
    </ul>

    <div class="alert alert-success fade in" style="display: none" id="sucesso">
        <a class="close" data-hide="alert">×</a>
        <strong>    Success!    </strong>
    </div>

    <div class="alert alert-danger fade in" style="display: none" id="erro">
        <a class="close" data-hide="alert">×</a>
        <strong>    Error!    </strong>
    </div>

    <div class="main">

        <!-- if( $posted ) {
            if( $result ){
                echo "<script type='text/javascript'>alert('" . $result  . "')</script>";
            }
            else
                echo "<script type='text/javascript'>alert('Não foi possivel executar o comando!')</script>";
        }

        ?> -->

        <h3>Agendar Leilao</h3>
        <div id="agendarLeilao" style="display: inline-flex;">

            <form method="post" action="">

                <div class ="responsiveAgendar" style="display: table-cell; "><b>ID Leilao: </b><input type="text" style="height: 23px;" name="idleilao" maxlength="10"  size="10"></div>

                <div class ="responsiveAgendar" style="display: table-cell; margin-left: 10px; "><b>Max Bid (&euro;): </b> <input type="text" style="height: 23px; " name="maxbid" maxlength="5" size="5"></div>

                <div class ="responsiveAgendar" style="display: table-cell; vertical-align:bottom;"><input type="submit" style="height: 23px; margin-left: 1em;" name="leilaoSubmit" value="Submit" class="buttonGreen "></div>
            </form>
        </div>

        <br>

        <div id="leiloesAgendadosDIV">
            <h3> Leiloes Agendados</h3>
            <div class="leiloesTbl">
                <table >

                  <tbody id="leiloesAgendados" class="tbl_leiloes">

                  </tbody>

                  <!--   <tr>
                        <th style="text-align:center;">Row ID</th>
                        <th style="text-align:center;">ID Leilao</th>
                        <th style="text-align:center;">Max Bid</th>
                        <th style="text-align:center;">Current Bid</th>
                        <th style="text-align:center;">Data Fim</th>
                        <th style="text-align:center;">Nome</th>
                        <th style="text-align:center;">Vendedor</th>
                        <th style="text-align:center;">Estado</th>
                        <th style="text-align:center;"></th>
                    </tr>



                    <tr class="table-row">
                     <td style="text-align:center;"><?php echo $i; ?></td>
                     <td style="text-align:center;"><?php echo $row["ID Leilao"]; ?></td>
                     <td class="idContentEditable" ondblclick="this.contentEditable=true; placeCaretAtEnd(this);" onBlur="saveToDatabase(event, this,'Max Bid','<?php echo $row["ID Leilao"]; ?>')" onkeypress="handle(event, this, 'Nome','<?php echo $row["ID Leilao"]; ?>')" style="text-align:center; <?php if (number_format(str_replace(',','.', $row["Current Bid"])) >= number_format(str_replace(',' , '.', $row["Max Bid"]))  ) echo "color: red; font-weight: bold;" ?> "><?php echo $row["Max Bid"]." &euro;"; ?></td>
                     <td style="text-align:center;"><?php echo $row["Current Bid"]." &euro;"; ?></td>
                     <td style="text-align:center;"><?php echo $row["Data Fim"]; ?></td>
                     <td><a href=<?php echo "'" . $row["URL"] . "'"; ?> target="_blank"><?php echo $row["Nome"]; ?></a></td>
                     <td style="text-align:center;"><?php echo $row["Vendedor"]; ?></td>
                     <td style="text-align:center;"><?php echo  $row["Estado"]; ?></td>
                     <td style="text-align:center">
                        <form style="margin: 0; text-align: center" method="post" action="">
                            <input type="hidden" value=<?php echo $row["ID Leilao"] ?> name="rowid" >
                            <input type="submit" name="rem_auction" value="Remover" class="buttonRed"></form></td>
                        </tr> -->

                </table>
            </div>
        </div>


        <div id="leiloesTerminados">
            <br>

            <h3> Leiloes Terminados</h3>
            <div class="leiloesTbl">
                <table id="tbl_leiloes">


                      <!--<tr>
                        <th style="text-align:center;">Row ID</th>
                        <th style="text-align:center;">ID Leilao</th>
                        <th style="text-align:center;">Max Bid</th>
                        <th style="text-align:center;">Current Bid</th>
                        <th style="text-align:center;">Data Fim</th>
                        <th style="text-align:center;">Nome</th>
                        <th style="text-align:center;">Vendedor</th>
                        <th style="text-align:center;">Vencedor</th>
                        <th style="text-align:center;">Estado</th>
			                  <th style="text-align:center;">Pago</th>
                        <th style="text-align:center;"></th>
                    </tr>


                       <tr class="<?php if ($row["Vencedor"] == 'barbosas') echo  'winner'; else echo looser; ?>">
                            <td style="text-align:center;"><?php echo $i; ?></td>
                            <td style="text-align:center;"><?php echo $row["ID Leilao"]; ?></td>
                            <td style="text-align:center;"><?php echo $row["Max Bid"]." &euro;"; ?></td>
                            <td style="text-align:center;"><?php echo $row["Current Bid"]." &euro;"; ?></td>
                            <td style="text-align:center;"><?php echo $row["Data Fim"]; ?></td>
                            <td><a href=<?php echo "'" . $row["URL"] . "'"; ?>><?php echo $row["Nome"]; ?></a></td>
                            <td style="text-align:center;"><?php echo $row["Vendedor"]; ?></td>
                            <td style="text-align:center;"><?php echo $row["Vencedor"]; ?></td>
                            <td style="text-align:center;"><?php echo  $row["Estado"]; ?></td>
		            <td style="text-align:center;"><input type="checkbox" name="pago" id="pago" onclick="check(this, '<?php echo $row["ID Leilao"]; ?>')" value="yes" <?php echo ($row['Pago']=='S' ? 'checked' : '');?>></td>
                            <td style="text-align:center">
                                <form style="margin: 0; text-align: center" method="post" action="">
                                    <input type="hidden" value=<?php echo $row["ID Leilao"] ?> name="rowid" >
                                    <input type="submit" name="rem_auction_term" value="Remover" class="buttonRed">
                                </form>
                            </td>
                        </tr> -->

            </table>
        </div>
    </div>

    <br>

    <div id='totalApagar'>

        <div class='buttonRemove'>
            <input type="button" name="removeAllAuctions" value="Remover Todos" class="buttonRed" onclick="removeAuctions('all');" />
        </div>

        <div class='buttonRemove'>
            <input type="button" name="removeLostAuctions" value="Remover Perdidos" class="buttonRed" onclick="removeAuctions('lost');" />
        </div>

		    <div class='buttonRemove'>
            <input type="button" name="removePaiedAuctions" value="Remover Pagos" class="buttonRed"  onclick="removeAuctions('paied');" />
        </div>

    </div>

    <h3>Pesquisas e Listagens</h3>
    <div id="pesquisas">

        <div class= 'btnPesquisa'>
            <form method="post" action="">
                <input type="submit" name="sendLista" value="Lista Completa Coisas" class="buttonGreen">
            </form>
        </div>

        <div class= 'btnPesquisa'>
            <form method="post" action="">
                <input type="submit" name="pesquisaCoisas" value="Pesquisa Coisas" class="buttonGreen">
            </form>
        </div>

        <div class= 'btnPesquisa'>
            <form method="post" action="">
                <input type="submit" name="listaMaugenioFull" value="Lista Completa Maugenio" class="buttonGreen">
            </form>
        </div>

        <div class= 'btnPesquisa'>
            <form method="post" action="">
                <input type="submit" name="pesquisaTodoColeccion" value="Pesquisa TodoColeccion" class="buttonGreen">
            </form>
        </div>



    </div>
</div>

</body>
